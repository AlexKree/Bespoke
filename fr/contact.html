<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Contact — The Bespoke Car</title>
  <style>
    body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; padding: 1.5rem; max-width: 800px; margin: 0 auto; color: #111; }
    h1 { margin-top: 0; }
    form p { margin: 0.75rem 0; }
    label { display: block; font-weight: 600; margin-bottom: 0.25rem; }
    input[type="text"], input[type="email"], textarea { width: 100%; padding: 0.5rem; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; }
    textarea { min-height: 140px; resize: vertical; }
    button { background: #0b74de; color: white; border: none; padding: 0.6rem 1rem; border-radius: 4px; cursor: pointer; }
    button[disabled] { opacity: 0.6; cursor: not-allowed; }
    .status { margin-top: 1rem; padding: 0.75rem; border-radius: 4px; display: none; }
    .status.error { background: #ffdede; color: #8a1f1f; display: none; }
    .status.success { background: #e6ffed; color: #1f6f3a; display: none; }
  </style>
</head>
<body>
  <h1>Contact</h1>
  <p>Utilisez le formulaire ci‑dessous pour nous envoyer un message. Nous répondrons dans les meilleurs délais.</p>

  <form id="contact-form" novalidate>
    <!-- Honeypot anti‑spam (ne pas remplir) -->
    <div style="display:none;" aria-hidden="true">
      <label for="bot-field">Ne pas remplir</label>
      <input type="text" name="bot-field" id="bot-field" autocomplete="off">
    </div>

    <p>
      <label for="name">Nom</label>
      <input type="text" id="name" name="name" required placeholder="Votre nom">
    </p>

    <p>
      <label for="email">Adresse e‑mail</label>
      <input type="email" id="email" name="email" required placeholder="votre@exemple.com">
    </p>

    <p>
      <label for="subject">Sujet (optionnel)</label>
      <input type="text" id="subject" name="subject" placeholder="Sujet du message">
    </p>

    <p>
      <label for="message">Message</label>
      <textarea id="message" name="message" required placeholder="Votre message"></textarea>
    </p>

    <p>
      <button type="submit" id="submit-btn">Envoyer</button>
    </p>

    <div id="form-status" class="status" role="status" aria-live="polite"></div>
  </form>

  <script>
  (function () {
    const form = document.getElementById('contact-form');
    const btn = document.getElementById('submit-btn');
    const statusEl = document.getElementById('form-status');

    function showStatus(message, type) {
      statusEl.textContent = message;
      statusEl.className = 'status ' + (type === 'error' ? 'error' : 'success');
      statusEl.style.display = 'block';
    }

    function clearStatus() {
      statusEl.textContent = '';
      statusEl.style.display = 'none';
    }

    form.addEventListener('submit', async function (e) {
      e.preventDefault();
      clearStatus();

      const name = document.getElementById('name').value.trim();
      const email = document.getElementById('email').value.trim();
      const subject = document.getElementById('subject').value.trim();
      const message = document.getElementById('message').value.trim();
      const bot = document.getElementById('bot-field') ? document.getElementById('bot-field').value : '';

      if (bot) return; // honeypot -> ignore silently
      if (!name || !email || !message) {
        showStatus('Veuillez remplir les champs requis (nom, e‑mail, message).', 'error');
        return;
      }

      const payload = { name, email, subject, message, 'bot-field': bot };

      try {
        btn.disabled = true;
        btn.textContent = 'Envoi…';

        const res = await fetch('/.netlify/functions/send-email', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload),
        });

        if (res.ok) {
          window.location.href = '/fr/merci.html';
        } else {
          let json = {};
          try { json = await res.json(); } catch (err) {}
          const errMsg = (json && json.error) ? json.error : 'Erreur lors de l\'envoi.';
          showStatus('Erreur : ' + errMsg, 'error');
        }
      } catch (err) {
        showStatus('Erreur réseau lors de l\'envoi. Merci de réessayer plus tard.', 'error');
      } finally {
        btn.disabled = false;
        btn.textContent = 'Envoyer';
      }
    });
  })();
  </script>
</body>
</html>